%~ \section{Heuristics and criteria for contact selection}
%~ \label{sec:heuristics}
% !TEX root =  ../main.tex
%~ \subsection{Manipulability-based heuristics for contact selection}
\section{Manipulability-based heuristics for contact selection}
\label{sec:heuristics}
This Section proposes two heuristics to select a contact that optimizes desired capabilities.
%~ These heuristics allow to locally optimize a contact location with respect to a particular task.
For instance, one can be interested in configurations that allow to efficiently exert a force in the global direction of motion, or to stay away from singular configurations.
We derive these heuristics from the work by \cite{Yoshikawa1984}, recalled here. %, that we present first.

\subsubsection{The force and velocity ellipsoids}

\begin{figure}[!tbp]
  \centering
	\begin{overpic}[width=1\linewidth]{figures/EFORT/ellipsoid}
		\put (8.5,1.2) {\small{Velocity ellipsoid}}
		\put (62.5,1.2) {\small{Force ellipsoid} \tiny{(scale 0.5)}}
	\end{overpic}
  \caption{Examples of velocity and force ellipsoids for a manipulator composed of 2 DoFs and 2 segments.
Only the horizontal and vertical speeds are shown (not the rotation speeds).}
 %~ since it would require being able to draw in four dimensions.}
		   \label{sec:efort_ellipsoid}
\end{figure}


We consider: a limb configuration $\mathbf{q}^k$; its end effector position $\mathbf{p}^k$; its Jacobian matrix
$\mathbf{J}^k(\mathbf{q}^k)$; a force $\mathbf{f}$ exerted by the end effector. For clarity in the rest of the section we omit the $k$ indices and write $\mathbf{J}^k(\mathbf{q}^k)$ as $\mathbf{J}$.
Yoshikawa~\cite{Yoshikawa1984} defines the velocity(~\ref{eq:vel}) and force~(\ref{eq:for}) ellipsoids:
 
 \begin{equation} 
 \label{eq:vel}
\mathbf{\dot{p}}^T(\mathbf{J}\mathbf{J}^T)^{-1}\mathbf{\dot{p}} \leq 1 
\end{equation}
 
 \begin{equation} 
 \label{eq:for}
\mathbf{f}^T (\mathbf{J}\mathbf{J}^T) \mathbf{f} \leq 1
\end{equation}

They describe the set of end-effector velocities (respectively forces) that can
be reached under the constraint $||\dot{\mathbf{q}}||^2 \leq 1$ for the current configuration.
The longer the axis of the ellipsoid is, the more important the velocity (resp. force) of the end-effector the direction of the axis can be (Figure~\ref{sec:efort_ellipsoid}).
 
\subsubsection{Manipulability-based heuristics}
From these definitions, we can derive two useful heuristics, that all account for the environment and the task being performed.
The first one, EFORT, was introduced by \cite{Tonneau2014}; the second one derives the manipulability measure proposed by Yoshikawa~\cite{Yoshikawa1984}.

With EFORT, we define the efficiency of a configuration as the ability of a limb to exert a force in a given direction.
We thus consider the force ellipsoid as a basis for our heuristic.
In a given direction $\uprho$, the length of the ellipsoid is given by the force-transmission ratio \citep{1087795}:
\begin{equation*}
f_\mathsf{T}(\mathbf{q}, \uprho) = [\uprho^{T}(\mathbf{J}\mathbf{J}	^{T})\uprho]^{-\frac{1}{2}}
\end{equation*}

In our problem, to compare candidate configurations, we include the quality of the contact surface, and choose $\uprho$ as the direction
opposite to the local motion (given by the difference between two consecutive root positions):

\begin{equation}
h_{\textrm{\it EFORT}}(\mathbf{q}, \uprho) = [\uprho^{T}(\mathbf{J}\mathbf{J}^T)\uprho]^{-\frac{1}{2}} ( \mu \mathbf{n}^T \uprho)
\end{equation}
where $\mu$ and $\mathbf{n}$ are respectively the friction coefficient and the normal vector of the contact surface.


%~ If the ability to generate large velocities at the effector is considered, we define a new heuristic $h_{vel}$ with a similar reasoning on the velocity ellipsoid:
%~ \begin{equation}
%~ h_{vel}(\mathbf{q}, \uprho) = [\uprho^{T}(\mathbf{J}\mathbf{J}^T)^{-1}\uprho]^{-\frac{1}{2}} ( \mu \mathbf{n}^T \uprho)
%~ \end{equation}

%~ $h_{\textrm{\it EFORT}}$ and $h_{vel}$ will favor contacts that allow large efforts or fast modifications in the velocity.
$h_{\textrm{\it EFORT}}$ will favor contacts that allow large efforts.
$EFORT$ in particular is useful for tasks such as standing up, pushing / pulling.
In other less demanding cases, manipulability can also be considered to avoid singularities.
To do so, we can consider the manipulability measure $h_{w}$, also given by Yoshikawa~\cite{Yoshikawa1984}:

\begin{equation} \label{ellipsoid}
h_{w}(\mathbf{q}) = \sqrt{det(\mathbf{J}\mathbf{J}^T)}
\end{equation}
$h_{w}$ measures the ``distance'' of a given configuration to singularity. When $h_{w}$ is equal to 0, the configuration is singular;
the greater $h_{w}$ is, the further away the configuration is from singularity.



